import{a as ue,b as Me}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-FUOLYZXL.js";import{b as Ee,e as ie,f as D,g as re,i as oe,j as ne,k as se,l as Ie}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-H3ILHJQN.js";import{a as J,b as Q,c as ee,e as te,g as L,h as De}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-OSYQOFPB.js";import{d as le,e as ce,f as pe,o as Ce}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-CVGBW63P.js";import{c as ae,e as Oe}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-7DXJRK74.js";import{b as X,h as Re}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-DUOY7Q5L.js";import{D as Y,F as Z}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-U4GS6NTD.js";import{a as Se}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-IFNIQOEY.js";import{a as G,c as Le}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-UTFVTVGR.js";import{b as M,d as j,g as h,i as z,k as K,p as T,q as F,s as B,u as U,v as N,z as v}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-45DYIENQ.js";import{a as q,c as Ae}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-WPVKPCDO.js";import{a as R,i as $,j as m,k as w}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-3WKB4E5O.js";import{b as H}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-4GXLZQJD.js";import{a as g,b as Ve,d as A,f as c}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-JPR5YHB4.js";function ct(t){if(typeof t=="number"&&t!==0){let i=Math.PI/180*t;return{angle:t,radians:i,cos:Math.cos(i),sin:Math.sin(i)}}return null}function je({rotation:t,point:i,origin:e}){if(!t||T(t))return i;let{cos:r,sin:o}=t;if(e){let p={x:e.left+e.width/2,y:e.top+e.height/2},u=p.x+(i.x-p.x)*r-(i.y-p.y)*o,f=p.y+(i.x-p.x)*o+(i.y-p.y)*r;return{x:u,y:f}}let n=r*i.x+o*i.y,a=r*i.y-o*i.x;return{x:n,y:a}}function fe(t){return typeof t=="string"?t:t===!0?"swing":null}function pt(t){let i=t.loop||(t.steps.length?t.steps[0].loop:void 0);if(i){let e=fe(i);if(e)return{startIndex:0,value:e}}else{let e=t.steps.findIndex((r,o)=>o!==0&&r.loop);if(e>-1){let r=t.steps[e],o=fe(r?.loop);if(r&&o)return{startIndex:e,value:o}}}return null}function ut(t){return t?.steps.length&&t.steps[0].startWhenInView||!1}function de(t){let i=t.animation,e=i&&!Array.isArray(i)?[i]:i||[];if(!e?.length)return;let r=!!t.fixed_position,o=t.is_full_width,n=t.is_full_height,a=!r&&!o&&!n,p=[];for(let u of e){if(T(u)||T(u.steps)||!u.type||u.type==="none")continue;let f=h(u);if(a||(f.UUID=Ue(JSON.stringify(f))),f.trigger){let d=f.trigger;f.trigger=d&&!Array.isArray(d)?[d]:d||[]}let b=[],l={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100};for(let d=0;d<f.steps.length;d++){let s=h(f.steps[d]);(!s.use_bezier||s.use_bezier&&!s.curve)&&(s.curve={}),s.curve&&!s.curve.c1&&(s.curve.c1={x:l.dx??0,y:l.dy??0}),s.use_move?(l.dx=s.dx,l.dy=s.dy):(s.dx=l.dx,s.dy=l.dy),s.curve&&!s.curve.c2&&(s.curve.c2={x:s.dx??0,y:s.dy??0}),s.use_opacity?(l.from_opacity=s.from_opacity,l.opacity=s.opacity):(s.from_opacity=l.from_opacity,s.opacity=l.opacity),s.use_scale?(l.from_scale=s.from_scale,l.scale=s.scale):(s.from_scale=l.from_scale,s.scale=l.scale),s.use_rotate?(l.from_rotate=s.from_rotate,l.rotate=s.rotate):(s.from_rotate=l.from_rotate,s.rotate=l.rotate),o&&(s.dx=0,s.rotate=0,s.from_rotate=0),n&&(s.dy=0,s.rotate=0,s.from_rotate=0),f.type==="scroll"&&!r&&d===0&&(s.delay_px=0),d!==0&&(delete s.from_opacity,delete s.from_rotate,delete s.from_scale),b.push(s)}b.length&&p.push({...f,steps:b})}if(p.length)return ze(p)}function E(t,i){let e={...t};if(i.rotation?.angle!==0){let{x:r,y:o}=je({rotation:i.rotation,point:{x:t.x??0,y:t.y??0}});e.x=r,e.y=o}return i.flipX&&e.x!==0&&(e.x*=-1),i.flipY&&e.y!==0&&(e.y*=-1),e}function ft(t,i){let e=[];for(let r of t.steps){let o={...r},{x:n,y:a}=E({x:o.dx??0,y:o.dy??0},i);o.dx=n,o.dy=a,typeof o.from_rotate=="number"&&o.from_rotate!==0&&(i.flipX&&(o.from_rotate*=-1),i.flipY&&(o.from_rotate*=-1)),typeof o.rotate=="number"&&o.rotate!==0&&(i.flipX&&(o.rotate*=-1),i.flipY&&(o.rotate*=-1)),o.curve={c1:E(r.curve.c1,i),c2:E(r.curve.c2,i)},e.push(o)}return{...t,steps:e}}function ze(t){let i=["click","hover","scroll","load","moveOnly","nonMove"];function e(r){return r.steps?.every(o=>o.use_move&&!o.use_scale&&!o.use_rotate)?"moveOnly":r.steps?.every(o=>!o.use_move)?"nonMove":r.type}return t.sort((r,o)=>i.indexOf(e(r))-i.indexOf(e(o)))}function dt(t){return t?.length?t.some(i=>i.type==="click"):!1}function mt(t){return t?.length?t.some(i=>i.type==="hover"):!1}function gt(t){return t?.length?t.some(i=>i.type==="scroll"):!1}function ht(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_rotate||e.use_move||e.use_scale)):!1}function yt(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_opacity)):!1}function Ke(t=[]){return!!t.find((e,r)=>e.use_rotate&&(r===0&&e.from_rotate!==0||e.rotate!==0))}function Fe(t=[]){return!!t.find((e,r)=>e.use_scale&&(r===0&&e.from_scale!==100||e.scale!==100))}function bt(t=[]){let i=q("viewer.offsetDistanceMove"),e=typeof window<"u"?window.CSS.supports('(offset-path: path("M 0,0")) and (offset-rotate: 0deg) and (offset-distance: 1px)'):!0,r=Be();return!i||!e?!1:r?!Ke(t)&&!Fe(t):!0}function xt(t,i){let e={};return i==="from"?(t.use_move&&(e.x=0,e.y=0),t.use_rotate&&typeof t.from_rotate=="number"&&(e.rotate=t.from_rotate),t.use_scale&&typeof t.from_scale=="number"&&(e.scale=t.from_scale/100),t.use_opacity&&typeof t.from_opacity=="number"&&(e.opacity=t.from_opacity/100)):(t.use_move&&(typeof t.dy=="number"&&(e.y=t.dy),typeof t.dx=="number"&&(e.x=t.dx)),t.use_rotate&&typeof t.rotate=="number"&&(e.rotate=t.rotate),t.use_scale&&typeof t.scale=="number"&&(e.scale=t.scale/100),t.use_opacity&&typeof t.opacity=="number"&&(e.opacity=t.opacity/100)),typeof e.opacity!="number"&&(e.opacity=1),typeof e.rotate!="number"&&(e.rotate=0),typeof e.scale!="number"&&(e.scale=1),typeof e.x!="number"&&(e.x=0),typeof e.y!="number"&&(e.y=0),e}function vt(t,i,e){let r={},o=U(t,e?["scale","rotate"]:["x","y","scale","rotate"]);return Object.keys(o).length&&(r.transform=ae(o,!0)),typeof t.opacity=="number"&&(r.opacity=t.opacity,r.opacity===0&&!i?r.visibility="hidden":r.visibility="visible"),r}function Ue(t){let i=0;for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);i=(i<<5)-i+r,i|=0}return String(Math.abs(i))}var Be,me=g(()=>{"use strict";H();v();Oe();Ae();Be=()=>{let t=typeof window<"u"?window.navigator.userAgent:"";if(/ Safari\//.test(t)&&!/ Chrom/.test(t)){let i=navigator.userAgent.match(/ Version\/(\d+)/)??[];return i[1]?Number(i[1])<=15:!1}else return!1}});var ge=g(()=>{"use strict"});var I=Ve((_t,he)=>{"use strict";var Ne=t=>{let i=new Set;do for(let e of Reflect.ownKeys(t))i.add([t,e]);while((t=Reflect.getPrototypeOf(t))&&t!==Object.prototype);return i};he.exports=(t,{include:i,exclude:e}={})=>{let r=o=>{let n=a=>typeof a=="string"?o===a:a.test(o);return i?i.some(n):e?!e.some(n):!0};for(let[o,n]of Ne(t.constructor.prototype)){if(n==="constructor"||!r(n))continue;let a=Reflect.getOwnPropertyDescriptor(o,n);a&&typeof a.value=="function"&&(t[n]=t[n].bind(t))}return t}});function He(t,i){let e=t.split(".");for(let r of i){let o=r[0];if(o==="set"||o==="delete"){let n=r[1],a=o==="set"?r[2]:void 0;if(F(n,e))return{result:a};let u=ye(n,e);if(u.length)return{result:$e(u,a)};let f=ye(e,n);if(f.length)return{result:qe(f,a)}}}}function ye(t,i){let e=[];if(i.length>t.length)return[];for(let r=0;r<t.length;r++){let o=t[r],n=i[r];if(typeof n>"u")e.push(o);else if(o!==n)break}return e}function $e(t,i){return N({},t,i)}function qe(t,i){return j(i,t)}function Xe(t){return typeof Q(t)=="number"}var _,be,y,k=g(()=>{"use strict";_=A(Se()),be=A(I());v();De();Z();y=class t{constructor(){return(0,be.default)(J(this))}subscribe(i,e){ee(this,r=>{if(typeof i=="string"){let o=i,n=e;if(typeof n=="function"){let a=He(o,r);typeof a<"u"&&n(a.result)}}else{let o=i;typeof o=="function"&&o(this)}})}detach(i){return te(i)}static createContext(){let i=(0,_.createContext)(void 0);function e({children:n,value:a}){if(!(typeof a=="object"&&a!==null&&a instanceof t))throw new Error("Only instances of `ProxyClass` should be used inside `Provider`");return Y(i.Provider,{value:a,children:n})}function r(){let n=(0,_.useContext)(i);if(!n)throw new Error("`useProxy` hook must be used inside `Provider`");return n}function o(n){let a=r(),p=L(a);if(typeof n=="function"){let u=n(p);return Xe(u)?L(u):u}return p}return{Provider:e,useSnapshot:o,useProxy:r}}}});var xe,P,W,O,ve=g(()=>{"use strict";Me();xe=A(I());v();Le();P=class P{constructor(){c(this,"observer",null);c(this,"observedElements",new Map);c(this,"handleResize",z(i=>{i.forEach(e=>{let r=this.observedElements.get(e.target);if(r){let{top:o,left:n,width:a,height:p}=e.contentRect;r({top:o,left:n,width:a,height:p})}})},20));(0,xe.default)(this),!G()&&(this.observer=new ue(this.handleResize))}observe(i,e){this.observedElements.set(i,e),this.observer?.observe(i)}unobserve(i){this.observedElements.delete(i),this.observer?.unobserve(i)}static getInstance(){return this._instance||(this._instance=new P),this._instance}};c(P,"_instance",null);W=P,O={observe(t,i){W.getInstance().observe(t,i)},unobserve(t){W.getInstance().unobserve(t)}}});var V,Te=g(()=>{"use strict";k();Ce();ve();V=class extends y{constructor(){super();c(this,"ref",null);c(this,"offset",{top:0,left:0,width:0,height:0});c(this,"rect",{top:0,left:0,width:0,height:0})}setElement(e){if(e===null)return;let r=this.ref;r&&O.unobserve(r),this.ref=this.detach(e),this.ref&&(this.offset=this.calculateOffsets(),this.rect=pe(e),O.observe(this.ref,o=>{this.rect=o}))}calculateOffsets(){return this.ref?{width:this.ref.offsetWidth,height:this.ref.offsetHeight,top:le(this.ref),left:ce(this.ref)}:{width:0,height:0,top:0,left:0}}}});var S,we=g(()=>{"use strict";H();Ee();k();Re();S=class extends y{constructor(e){super();c(this,"project");c(this,"linkData",null);this.project=e.project,this.linkData=this.getLinkData(e.widget.model),this.project.subscribe("pages",()=>{this.linkData=this.getLinkData(e.widget.model)})}doesWidgetHasLink(e){return["button","picture","shape"].includes(e.type)}getLinkData(e){if(!e||!this.doesWidgetHasLink(e)||!e.clickLink)return null;if(e.clickLink?.toLowerCase()==="__rm_anchor")return{type:"Anchor",target:e.clickTarget,url:`${e.anchor_link_pos}px`,anchorPosition:e.anchor_link_pos,pageId:e.clickPage,closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("mailto:"))return{type:"Email",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("mailto:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("tel:"))return{type:"Phone",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("tel:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("back to top"))return{type:"ScrollToTop",url:"",closeTip:e.closeTip};if(e.clickLink?.toLowerCase()==="__rm_goback")return{type:"GoBack",url:"",closeTip:e.closeTip};if(this.project.getPageNum(e.clickLink)){let r=this.project.getPageNum(e.clickLink);return{type:"Page",target:e.clickTarget,pageId:e.clickLink,url:r?`${r}`:"",closeTip:e.closeTip}}else if(X(e.clickLink))return{type:"URL",target:e.clickTarget,url:e.clickLink,closeTip:e.closeTip};return null}}});function x(t){switch(t){case"phone_portrait":return"viewport_phone_portrait";case"tablet_portrait":return"viewport_tablet_portrait";default:return"viewport_default"}}function Ze(t,i){let e=x(i);if(e!=="viewport_default"){let r=t[e];if(r&&Object.keys(r).length>0)return t[e]}return t}function Jt(t,i){let e=Ze(t,i);return e&&e.height?e.height:t.height}function Qt({pageViewport:t,desktopWidth:i,phoneWidth:e}){return!t||t==="default"?i||m.dictionary.default.width:t==="phone_portrait"?e||m.dictionary.phone_portrait.width:m.dictionary[t].width}var _e=g(()=>{"use strict";w()});function Ge(t,i,e){let r=i[m.globalPrefix+t]||[],o=r.find(n=>n.pid===e)||r.find(n=>n.pid==="default");return!o||o.value===void 0?i[t]:o.value}function C(t,i){let e=h(t);for(let r of m.globalKeys)if(e[`${m.globalPrefix}${r}`]){let o=Ge(r,e,i);typeof o<"u"&&(e[r]=o)}return e}var ke=g(()=>{"use strict";w();v()});var We,Pe,hi,yi,bi,Je=g(()=>{"use strict";w();w();v();ge();k();Te();we();_e();Ie();me();ke();We=99999,Pe=class t extends y{constructor(e){super();c(this,"currentViewport");c(this,"_model");c(this,"model");c(this,"element");c(this,"link");c(this,"triggersStore");c(this,"animationsStore");c(this,"zIndexStore");c(this,"hasViewports");c(this,"isWidgetTrigger");this.triggersStore=e.triggersStore,this.animationsStore=e.animationsStore,this.zIndexStore=e.zIndexStore,this.currentViewport=e.pageMeta?.state.currentViewport||e.project.projectViewport.value,this.element=this.detach(new V),this._model=this.prepareWidgetData(e.widget),this.model=this._model,this.computeWidgetModel(),this.hasViewports=this.calculateHasViewports(),this.isWidgetTrigger=this.triggersStore.isWidgetTrigger(this.model._id),this.bindViewportListener(e.project.projectViewport,e.pageMeta),this.bindElementListener(),this.bindTriggersListener(),this.animationsStore.addWidget({widgetId:this.model._id,animations:this.model.animation||[],rotation:this.model.angle,flipX:!!this.model.flip_h,flipY:!!this.model.flip_v,rect:{width:this.model.w,height:this.model.h,top:this.model.y,left:this.model.x}}),this.link=new S({widget:this,project:e.project})}bindElementListener(){this.element.subscribe("ref",()=>{this.element.ref&&this.triggersStore.bindTriggerElement(this.model._id,this.element.ref)})}bindTriggersListener(){this.triggersStore.subscribe(()=>{this.isWidgetTrigger=this.triggersStore.isWidgetTrigger(this.model._id)})}addTriggerCallback(e){this.triggersStore.addTriggerCallback({...e,responderWidgetId:this.model._id})}bindViewportListener(e,r){r?(this.currentViewport=r.state.currentViewport,r.subscribe("state.currentViewport",o=>{this.currentViewport=o,this.computeWidgetModel()})):(this.currentViewport=e.value,e.subscribe("value",o=>{this.currentViewport=o,this.computeWidgetModel()}))}computeWidgetModel(){let e=this.currentViewport;this.model=this.getViewportData(e)}getViewportData(e){let r=x(e);return e==="default"||!this.hasViewport(e)?this._model:{...this._model,...this._model[r]}}setViewportWidgetState(e){let r=this.currentViewport,o=this._model;if(typeof e.z=="number"&&this.zIndexStore.setZIndex(this._model._id,e.z),r==="default")Object.assign(this._model,{...e});else{let n=x(r);Object.assign(this._model,{[n]:{...o[n]||{},...e}})}this.computeWidgetModel()}prepareWidgetData(e){let r=h(e);return $(r,(o,n)=>{if(!o)return;let a=t.getWidgetViewportData(r,n,r.pid);for(let p of m.globalKeys)typeof a?.[p]<"u"&&(o[p]=a[p]);"animation"in o&&(o.animation=de(o))}),r}isHiddenInViewport(e=this.currentViewport){let r=this.getViewportData(e);return!!(!r||r.hidden&&!r.is_above)}hasViewport(e){let r=x(e);return r==="viewport_default"?!0:r in this._model&&Object.keys(this._model[r]).length>0}calculateHasViewports(){return Object.values(R).some(e=>!this.isHiddenInViewport(e))}moveTo(e){this.setViewportWidgetState(e)}zIndexToTop(){this.setViewportWidgetState({z:this.model.z+We})}zIndexResetToNormal(){this.setViewportWidgetState({z:this.model.z-We})}setTopmostZIndex(){this.setViewportWidgetState({z:this.zIndexStore.getTopmostZIndex()+1})}static getWidgetViewportData(e,r,o){let n=h(e);if(ne(n)||se(n))return n;let a=x(r);if(a in n){let p=h(n),u={},f=Object.keys(n[a]);for(let l of f){if(re(n)&&(l==="borders"||l==="weight"||l==="bg_color")||D(n)&&l==="picture"||ie(n)&&n.version===3&&l==="blocks")continue;let d=!1;d||(u[l]=void 0),d||(u[l]=oe(n)&&!n[a][l]&&K(m.viewport_fields.button,m.viewport_fields_common).includes(l)?n[l]:void 0)}let b=M(p,u,B(n[a],["_id","modelType"]));return b.is_global?C(b,o):b}else if(r==="default")return n.is_global?C(n,o):n;return null}static canUseWidgetForLayerType(e,r){if(!e)return!1;if(D(e)&&r==="fixed")return!0;let o=e?.fixed_position&&r==="regular",n=!e?.fixed_position&&r==="fixed";return!o&&!n}},{useSnapshot:hi,useProxy:yi,Provider:bi}=y.createContext()});export{I as a,y as b,k as c,ct as d,je as e,pt as f,ut as g,ft as h,dt as i,mt as j,gt as k,ht as l,yt as m,bt as n,xt as o,vt as p,me as q,ge as r,V as s,Te as t,x as u,Jt as v,Qt as w,_e as x,C as y,ke as z,Pe as A,hi as B,bi as C,Je as D};
