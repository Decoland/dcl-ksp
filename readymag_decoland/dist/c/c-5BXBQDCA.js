import{a as nt,b as en}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-S7HI7YZY.js";import{a as it,b as st}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-EKH35OWM.js";import{a as dt,b as nn}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-TFUSHE37.js";import{b as lt,k as rn}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-MDQFU5S5.js";import{c as gt,d as ct,e as pt,f as ut,h as mt,j as Pt,o as Tt,p as sn}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-JPJNOQMB.js";import{a as he,b as rt}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-5U7VAUQ6.js";import{a as at,b as on}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-LDGS2NF6.js";import{a as O,b as Pe}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-QE7PLCIB.js";import{b as Fe,e as tn}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-YO7WEKGL.js";import{k as H,n as G,p as je}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-SU2NNAPL.js";import{C as fe,D as d,E as p,F as V}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-U4GS6NTD.js";import{a as Ge}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-IFNIQOEY.js";import{a as W,b as ee}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-ZACCG5AA.js";import{b as ie,c as Xo}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-DHS3XUYJ.js";import{b as Qo}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-USIQRDD3.js";import{a as Te,c as ot}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-WPVKPCDO.js";import{g as tt,k as Zo}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-3WKB4E5O.js";import{b as Yo}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-4GXLZQJD.js";import{a as _,d as ue,f as me}from"https://st-p.rmcdn.net/2ec2f837/dist/c/c-JPR5YHB4.js";var se=_(()=>{"use strict"});function u({children:e}){return d(Fe,{textStyle:"small",children:e})}function P({children:e}){return d(Fe,{textStyle:"small",fontStyle:"italic",children:e})}var Ve=_(()=>{"use strict";tn();V()});var z,C,ht,ft=_(()=>{"use strict";Ve();se();V();z={TextWidget:p(u,{children:["Click on the ",d(P,{children:"plus"})," in the lower-left panel and choose a Text widget"]}),TextWidgetOpenPanel:"Select the text widget to get back on track",PictureWidgetSelect:p(u,{children:["Click on the ",d(P,{children:"plus"})," in the lower-left panel and add a Picture widget"]}),PictureWidgetUse:"Select the picture widget again",ButtonWidgetSelect:p(u,{children:["Click on the plus and choose a ",d(P,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Select the button widget you added earlier",ButtonWidgetAddLink:"Select the button widget you added earlier",CreateLayout:p(u,{children:["\u0421lick the ",d(P,{children:"Devices"})," icon to add a mobile layout"]}),CreateLayoutSelect:p(u,{children:["\u0421lick the ",d(P,{children:"Devices"})," icon to add a mobile layout"]})},C={TextWidget:p(u,{children:["First, let\u2019s learn how to work with text blocks. Click here to add a ",d(P,{children:"Text"})," widget"]}),TextWidgetOpenPanel:p(u,{children:["Now open the ",d(P,{children:"Typography"})," panel"]}),TextWidgetProperties:"Change the font size to 24",TextWidgetSelect:d(u,{children:"Let\u2019s say you want to finish text editing\u2014just click on any empty area"}),TextWidgetDrag:d(u,{children:"Now drag the text to the left side of the page"}),PictureWidget:p(u,{children:["You\u2019re off to a good start! Now click on the ",d(P,{children:"plus"})," to start adding a picture"]}),PictureWidgetSelect:p(u,{children:["Choose the ",d(P,{children:"Picture"})," widget"]}),PictureWidgetUse:"Click on the Unsplash icon and choose a random picture",PictureWidgetChoose:"Choose a random picture",PictureWidgetClickOutside:"Now let\u2019s align this widget to the grid. Click on the empty area",SelectGrids:p(u,{children:["Then select ",d(P,{children:"Grid & Guides"})]}),ChangeGrids:p(u,{children:["The 3 dots on the right top of the settings correspond to 3 grid presets",d("br",{}),"Click on the last dot"]}),PictureWidgetPlace:"Move the picture around the page to align it to the grid",TurnOffGuides:p(u,{children:["Disable the guides by pressing the ",d(P,{children:"H"})," key"]}),PageHeight:p(u,{children:["Now we\u2019ll decrease the page height.",d("br",{}),"Scroll down and drag the ",d(P,{children:"Blue Diamond"})," up"]}),ButtonWidget:p(u,{children:["Well done, now let\u2019s add a button. Click on the ",d(P,{children:"plus"})," first"]}),ButtonWidgetSelect:p(u,{children:["Choose a ",d(P,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Change the button color to black",ButtonWidgetAddLink:"Then add a link to the button",ButtonWidgetAddLinkType:"Add a link to the button",CreateLayout:p(u,{children:["Now let\u2019s see how your design looks in the mobile version",d("br",{}),"Click on the ",d(P,{children:"Devices"})," icon"]}),CreateLayoutSelect:p(u,{children:["Click on the ",d(P,{children:"plus"})," at the top of the Devices panel"]}),AdjustSizes:"It\u2019s time to add the finishing touch. Swap the picture with the text widget",ArrangeMobile:p(u,{children:["Click ",d(P,{children:"Single column"})," to arrange a mobile version"]}),PreviewAndPublish:p(u,{children:["Last step! Click on the ",d(P,{children:"Eye"})," icon to preview your project before publishing"]}),BackToConstructor:p(u,{children:["Hit ",d(P,{children:"Publish"})," or click the pencil icon to go back to the editor"]})},ht={TextWidget:{name:"TextWidget",text:C.TextWidget,num:1,nextStep:"TextWidgetOpenPanel",widgetSelectionType:"text",fallbackText:z.TextWidget},TextWidgetOpenPanel:{name:"TextWidgetOpenPanel",text:C.TextWidgetOpenPanel,num:2,prevStep:"TextWidget",nextStep:"TextWidgetProperties",fallbackText:z.TextWidgetOpenPanel},TextWidgetProperties:{name:"TextWidgetProperties",text:C.TextWidgetProperties,num:3,prevStep:"TextWidgetOpenPanel",nextStep:"TextWidgetSelect",fallbackText:z.TextWidgetOpenPanel},TextWidgetSelect:{name:"TextWidgetSelect",text:C.TextWidgetSelect,num:4,prevStep:"TextWidgetProperties",nextStep:"TextWidgetDrag"},TextWidgetDrag:{name:"TextWidgetDrag",text:C.TextWidgetDrag,num:5,prevStep:"TextWidgetSelect",nextStep:"PictureWidget"},PictureWidget:{name:"PictureWidget",text:C.PictureWidget,num:6,prevStep:"TextWidgetDrag",nextStep:"PictureWidgetSelect",fallbackStep:"SelectGrids",widgetSelectionType:"picture"},PictureWidgetSelect:{name:"PictureWidgetSelect",text:C.PictureWidgetSelect,num:7,prevStep:"PictureWidget",nextStep:"PictureWidgetUse",widgetSelectionType:"picture",fallbackText:z.PictureWidgetSelect},PictureWidgetUse:{name:"PictureWidgetUse",text:C.PictureWidgetUse,num:8,prevStep:"PictureWidgetSelect",nextStep:"PictureWidgetChoose",fallbackText:z.PictureWidgetUse},PictureWidgetChoose:{name:"PictureWidgetChoose",text:C.PictureWidgetChoose,num:9,prevStep:"PictureWidgetUse",nextStep:"PictureWidgetClickOutside"},PictureWidgetClickOutside:{name:"PictureWidgetClickOutside",text:C.PictureWidgetClickOutside,num:10,prevStep:"PictureWidgetUse",nextStep:"SelectGrids",fallbackStep:"SelectGrids"},SelectGrids:{name:"SelectGrids",text:C.SelectGrids,num:11,prevStep:"PictureWidgetClickOutside",nextStep:"ChangeGrids"},ChangeGrids:{name:"ChangeGrids",text:C.ChangeGrids,num:12,prevStep:"SelectGrids",nextStep:"PictureWidgetPlace"},PictureWidgetPlace:{name:"PictureWidgetPlace",text:C.PictureWidgetPlace,num:13,prevStep:"ChangeGrids",nextStep:"TurnOffGuides"},TurnOffGuides:{name:"TurnOffGuides",text:C.TurnOffGuides,num:14,prevStep:"PictureWidgetPlace",nextStep:"PageHeight"},PageHeight:{name:"PageHeight",text:C.PageHeight,num:15,prevStep:"TurnOffGuides",nextStep:"ButtonWidget"},ButtonWidget:{name:"ButtonWidget",text:C.ButtonWidget,num:16,prevStep:"PageHeight",nextStep:"ButtonWidgetSelect"},ButtonWidgetSelect:{name:"ButtonWidgetSelect",text:C.ButtonWidgetSelect,num:17,prevStep:"ButtonWidget",nextStep:"ButtonWidgetAdjustVisualProperties",widgetSelectionType:"button",fallbackText:z.ButtonWidgetSelect},ButtonWidgetAdjustVisualProperties:{name:"ButtonWidgetAdjustVisualProperties",text:C.ButtonWidgetAdjustVisualProperties,num:18,prevStep:"ButtonWidgetSelect",nextStep:"ButtonWidgetAddLink",fallbackText:z.ButtonWidgetAdjustVisualProperties},ButtonWidgetAddLink:{name:"ButtonWidgetAddLink",text:C.ButtonWidgetAddLink,num:19,prevStep:"ButtonWidgetAdjustVisualProperties",nextStep:"ButtonWidgetAddLinkType",fallbackText:z.ButtonWidgetAddLink},ButtonWidgetAddLinkType:{name:"ButtonWidgetAddLinkType",text:C.ButtonWidgetAddLinkType,num:20,prevStep:"ButtonWidgetAddLink",nextStep:"CreateLayout"},CreateLayout:{name:"CreateLayout",text:C.CreateLayout,num:21,prevStep:"ButtonWidgetAddLink",nextStep:"CreateLayoutSelect",fallbackText:z.CreateLayout},CreateLayoutSelect:{name:"CreateLayoutSelect",text:C.CreateLayoutSelect,num:22,prevStep:"CreateLayout",nextStep:"ArrangeMobile",fallbackText:z.CreateLayoutSelect},ArrangeMobile:{name:"ArrangeMobile",text:C.ArrangeMobile,num:23,prevStep:"CreateLayoutSelect",nextStep:"PreviewAndPublish"},PreviewAndPublish:{name:"PreviewAndPublish",text:C.PreviewAndPublish,num:24,prevStep:"ArrangeMobile",nextStep:"BackToConstructor"},BackToConstructor:{name:"BackToConstructor",text:C.BackToConstructor,num:25,prevStep:"PreviewAndPublish"}}});var j,y,St,bt=_(()=>{"use strict";Ve();se();V();j={TextWidget:p(u,{children:["Click on the ",d(P,{children:"plus"})," in the lower-left panel and choose a Text widget"]}),TextWidgetOpenPanel:"Select the text widget to get back on track",PictureWidgetSelect:p(u,{children:["Click on the ",d(P,{children:"plus"})," in the lower-left panel and add a Picture widget"]}),PictureWidgetUse:"Select the picture widget again",ButtonWidgetSelect:p(u,{children:["Click on the plus and choose a ",d(P,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Select the button widget you added earlier",ButtonWidgetAddLink:"Select the button widget you added earlier",CreateLayout:p(u,{children:["\u0421lick the ",d(P,{children:"Devices"})," icon to add a mobile layout"]}),CreateLayoutSelect:p(u,{children:["\u0421lick the ",d(P,{children:"Devices"})," icon to add a mobile layout"]})},y={TextWidget:p(u,{children:["First, let\u2019s learn how to work with text blocks. Click here to add a ",d(P,{children:"Text"})," widget"]}),TextWidgetOpenPanel:p(u,{children:["Now open the ",d(P,{children:"Typography"})," panel"]}),TextWidgetProperties:"Change the font size to 13 and click on the empty area",TextWidgetSelect:d(u,{children:"Let\u2019s say you want to finish text editing\u2014just click on any empty area"}),TextWidgetDrag:d(u,{children:"Now drag the text to its placeholder (a place reserved for a particular element)"}),PictureWidget:p(u,{children:["You\u2019re off to a good start! Now click on the ",d(P,{children:"plus"})," to start adding a picture"]}),PictureWidgetSelect:p(u,{children:["Choose the ",d(P,{children:"Picture"})," widget"]}),PictureWidgetUse:"Click on the Unsplash icon and pick a picture of a building",PictureWidgetChoose:"Pick a picture building",PictureWidgetClickOutside:"Now let\u2019s align this widget to the grid. Click on the empty area",SelectGrids:p(u,{children:["Then select ",d(P,{children:"Grid & Guides"})]}),ChangeGrids:p(u,{children:["The 3 dots on the right top of the settings correspond to 3 grid presets",d("br",{}),"Click on the last dot"]}),PictureWidgetPlace:"Move the picture to its placeholder and align it to the grid",EverythingInItsRightPlace:"Check that all the added widgets are aligned to the grid and click on empty area",TurnOffGuides:p(u,{children:["Disable the guides by pressing the ",d(P,{children:"H"})," key"]}),PageHeight:p(u,{children:["Now we\u2019ll decrease the page height.",d("br",{}),"Scroll down and drag the ",d(P,{children:"Blue Diamond"})," up"]}),OpenLayersPanel:p(u,{children:["Go to the ",d(P,{children:"Layers"})," panel by pressing ",d(P,{children:"Q"})," to delete placeholders no longer needed"]}),SelectBlocksAndDelete:p(u,{children:["Select widget groups of placeholders and press ",d(P,{children:"Delete"})]}),DeleteBlocks:p(u,{children:["Go to the ",d(P,{children:"Layers"})," panel by pressing ",d(P,{children:"Q"})," and delete no longer needed widget groups of placeholders"]}),ButtonWidget:p(u,{children:["Well done, now let\u2019s add a button. Click on the ",d(P,{children:"plus"})," first"]}),ButtonWidgetSelect:p(u,{children:["Choose a ",d(P,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Change the button color to black and click on the empty area",ButtonWidgetAddLink:p(u,{children:["Choose an ",d(P,{children:"Anchor"})," type link from the dropdown",d("br",{}),"and add it to the button"]}),ButtonWidgetAddLinkType:p(u,{children:["Add ",d(P,{children:"Anchor"})," link to the button"]}),ButtonWidgetAnchorLinkPosition:"Set the place were the anchor link will lead\u2014above the pictures",ButtonWidgetDrag:"Now drag the button to its placeholder",CreateLayout:p(u,{children:["Now let\u2019s see how your design looks in the mobile version",d("br",{}),"Click on the ",d(P,{children:"Devices"})," icon"]}),CreateLayoutSelect:p(u,{children:["Click on the ",d(P,{children:"plus"})," at the top of the Devices panel"]}),AdjustSizes:"It\u2019s time to add the finishing touch. Swap the picture with the text widget",ArrangeMobile:p(u,{children:["Click ",d(P,{children:"Single column"})," to arrange a mobile version"]}),PreviewAndPublish:p(u,{children:["Last step! Click on the ",d(P,{children:"Eye"})," icon to preview your project before publishing"]}),BackToConstructor:p(u,{children:["Hit ",d(P,{children:"Publish"})," or click the pencil icon to go back to the editor"]})},St={TextWidget:{name:"TextWidget",text:y.TextWidget,num:1,nextStep:"TextWidgetOpenPanel",widgetSelectionType:"text",fallbackText:j.TextWidget},TextWidgetOpenPanel:{name:"TextWidgetOpenPanel",text:y.TextWidgetOpenPanel,num:2,prevStep:"TextWidget",nextStep:"TextWidgetProperties",fallbackText:j.TextWidgetOpenPanel},TextWidgetProperties:{name:"TextWidgetProperties",text:y.TextWidgetProperties,num:3,prevStep:"TextWidgetOpenPanel",nextStep:"TextWidgetSelect",fallbackText:j.TextWidgetOpenPanel},TextWidgetSelect:{name:"TextWidgetSelect",text:y.TextWidgetSelect,num:4,prevStep:"TextWidgetProperties",nextStep:"TextWidgetDrag"},TextWidgetDrag:{name:"TextWidgetDrag",text:y.TextWidgetDrag,num:5,prevStep:"TextWidgetSelect",nextStep:"ButtonWidget"},ButtonWidget:{name:"ButtonWidget",text:y.ButtonWidget,num:6,prevStep:"TextWidgetDrag",nextStep:"ButtonWidgetSelect"},ButtonWidgetSelect:{name:"ButtonWidgetSelect",text:y.ButtonWidgetSelect,num:7,prevStep:"ButtonWidget",nextStep:"ButtonWidgetDrag",widgetSelectionType:"button",fallbackText:j.ButtonWidgetSelect},ButtonWidgetDrag:{name:"ButtonWidgetDrag",text:y.ButtonWidgetDrag,num:8,prevStep:"ButtonWidgetSelect",nextStep:"ButtonWidgetAdjustVisualProperties"},ButtonWidgetAdjustVisualProperties:{name:"ButtonWidgetAdjustVisualProperties",text:y.ButtonWidgetAdjustVisualProperties,num:9,prevStep:"ButtonWidgetDrag",nextStep:"ButtonWidgetAddLink",fallbackText:j.ButtonWidgetAdjustVisualProperties},ButtonWidgetAddLink:{name:"ButtonWidgetAddLink",text:y.ButtonWidgetAddLink,num:10,prevStep:"ButtonWidgetAdjustVisualProperties",nextStep:"ButtonWidgetAddLinkType",fallbackText:j.ButtonWidgetAddLink},ButtonWidgetAddLinkType:{name:"ButtonWidgetAddLinkType",text:y.ButtonWidgetAddLinkType,num:11,prevStep:"ButtonWidgetAddLink",nextStep:"ButtonWidgetAnchorLinkPosition",fallbackText:j.ButtonWidgetAddLink},ButtonWidgetAnchorLinkPosition:{name:"ButtonWidgetAnchorLinkPosition",text:y.ButtonWidgetAnchorLinkPosition,num:12,prevStep:"ButtonWidgetAddLink",nextStep:"PictureWidget"},PictureWidget:{name:"PictureWidget",text:y.PictureWidget,num:13,prevStep:"ButtonWidgetAddLink",nextStep:"PictureWidgetSelect",widgetSelectionType:"picture"},PictureWidgetSelect:{name:"PictureWidgetSelect",text:y.PictureWidgetSelect,num:14,prevStep:"PictureWidget",nextStep:"PictureWidgetUse",widgetSelectionType:"picture",fallbackText:j.PictureWidgetSelect},PictureWidgetUse:{name:"PictureWidgetUse",text:y.PictureWidgetUse,num:15,prevStep:"PictureWidgetSelect",nextStep:"PictureWidgetChoose",fallbackText:j.PictureWidgetUse},PictureWidgetChoose:{name:"PictureWidgetChoose",text:y.PictureWidgetChoose,num:16,prevStep:"PictureWidgetUse",nextStep:"PictureWidgetClickOutside"},PictureWidgetClickOutside:{name:"PictureWidgetClickOutside",text:y.PictureWidgetClickOutside,num:17,prevStep:"PictureWidgetUse",nextStep:"SelectGrids",fallbackStep:"SelectGrids"},SelectGrids:{name:"SelectGrids",text:y.SelectGrids,num:18,prevStep:"PictureWidgetClickOutside",nextStep:"ChangeGrids"},ChangeGrids:{name:"ChangeGrids",text:y.ChangeGrids,num:19,prevStep:"SelectGrids",nextStep:"PictureWidgetPlace"},PictureWidgetPlace:{name:"PictureWidgetPlace",text:y.PictureWidgetPlace,num:20,prevStep:"ChangeGrids",nextStep:"EverythingInItsRightPlace"},EverythingInItsRightPlace:{name:"EverythingInItsRightPlace",text:y.EverythingInItsRightPlace,num:21,prevStep:"PictureWidgetPlace",nextStep:"TurnOffGuides"},TurnOffGuides:{name:"TurnOffGuides",text:y.TurnOffGuides,num:22,prevStep:"EverythingInItsRightPlace",nextStep:"PageHeight"},PageHeight:{name:"PageHeight",text:y.PageHeight,num:23,prevStep:"TurnOffGuides",nextStep:"OpenLayersPanel"},OpenLayersPanel:{name:"OpenLayersPanel",text:y.OpenLayersPanel,num:24,prevStep:"PageHeight",nextStep:"SelectBlocksAndDelete"},SelectBlocksAndDelete:{name:"SelectBlocksAndDelete",text:y.SelectBlocksAndDelete,num:25,prevStep:"OpenLayersPanel",nextStep:"CreateLayout"},CreateLayout:{name:"CreateLayout",text:y.CreateLayout,num:26,prevStep:"ButtonWidgetAddLink",nextStep:"CreateLayoutSelect",fallbackText:j.CreateLayout},CreateLayoutSelect:{name:"CreateLayoutSelect",text:y.CreateLayoutSelect,num:27,prevStep:"CreateLayout",nextStep:"ArrangeMobile",fallbackText:j.CreateLayoutSelect},ArrangeMobile:{name:"ArrangeMobile",text:y.ArrangeMobile,num:28,prevStep:"CreateLayoutSelect",nextStep:"PreviewAndPublish"},PreviewAndPublish:{name:"PreviewAndPublish",text:y.PreviewAndPublish,num:29,prevStep:"ArrangeMobile",nextStep:"BackToConstructor"},BackToConstructor:{name:"BackToConstructor",text:y.BackToConstructor,num:30,prevStep:"PreviewAndPublish"}}});var Se,xt=_(()=>{"use strict";se();ft();bt();Se={0:ht,1:St}});var wt,yt=_(()=>{"use strict";ee();wt=()=>{W.post("/api/mailchimp/help-tour-not-finished")}});var Wt,$e,be,ln,Ct,gn,cn,$,dr,lr,Q,vt,gr,cr,pn,un,pr,ur,mr,Pr,xe,kt=_(()=>{"use strict";rt();je();Pe();xt();se();yt();qe();on();Wt={tourType:0,modalStatus:"unshow",started:!1,waiting:!1,showNotice:!1,step:null,totalSteps:0},$e=new Set,be=e=>typeof(window.RM.constructorRouter?.me?.get("ab_flags")||{}).newProductTourLayout<"u"?e===1?"2401new":"2401old":"no",ln=()=>{let e=window.RM.constructorRouter?.me,t=e?.get("behavior_metrics")||{};if(!t||!e)return;let r={...t,constructor_tour_finished:!0};e.save({behavior_metrics:r},{patch:!0})},Ct=(e,t)=>t?Array.isArray(e)?e.includes(t.name):t.name===e:!1,[gn,cn,$,dr]=he(Wt),lr=()=>gn({hookType:"layout"}),Q=e=>{cn(e),O.trigger("helptour:update",e)},vt=e=>{let t=$();Q({...t,modalStatus:e})},gr=(e=0)=>{let{started:t}=$();if(t)return;let r=Object.values(Se[e]),l=r[0];Q({tourType:e,modalStatus:"unshow",started:!0,waiting:!1,showNotice:!1,step:l,totalSteps:r.length}),G.sendAmplitudeEvent(H.HelpTour,{status:"started",experiment:be(e)})},cr=()=>{let{started:e}=$();e&&vt("closing")},pn=()=>{let{started:e,step:t,totalSteps:r}=$();if(!e||!t){setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerMetrics","helpTourSkipped")},1e3);return}$e.clear(),Q(Wt),t?.num<r&&wt()},un=e=>{let{step:t,tourType:r}=$();pn(),vt("end"),e?.(),G.sendAmplitudeEvent(H.HelpTourProgress,{step:t?.num,experiment:be(r)}),G.sendAmplitudeEvent(H.HelpTour,{status:"finished",experiment:be(r)}),ln()},pr=(e,t)=>{let r=$(),{step:l,started:m,tourType:T,totalSteps:g}=r;if(!m)return;if(!l?.nextStep){un(t?.cb);return}let v=(Array.isArray(e)?e:[e]).includes(l.name),M=t?.fallback;if(!v||M&&!l.fallbackStep)return;let N=M&&l.fallbackStep?l.fallbackStep:l.nextStep,w=Se[T][N];w&&(Q({...r,waiting:!1,showNotice:!1,step:w}),at(()=>{for(let f=1;f<=g&&!(f>l.num);f++)f<=l.num&&!$e.has(f)&&(G.sendAmplitudeEvent(H.HelpTourProgress,{step:f,experiment:be(T)}),$e.add(f))}))},ur=e=>{let t=$(),{step:r,started:l,tourType:m}=t;if(!l||!r?.prevStep||!(Array.isArray(e)?e:[e]).includes(r.name))return;let S=Se[m][r.prevStep];S&&Q({...t,waiting:!1,showNotice:!1,step:S})},mr=e=>{let t=$(),{step:r,started:l}=t;!l||!Ct(e,r)||Q({...t,waiting:!0})},Pr=(e,t)=>{let r=$(),{step:l,started:m,showNotice:T}=r;!m||!Ct(e,l)||Q({...r,showNotice:t.show??!T})},xe=()=>$().started});var we,mn,Pn,Ot=_(()=>{"use strict";we=(e,t,r,l)=>{let m=r.findIndex(v=>v.num===e),T=m>=0?r[m]:null,g=e+1,S=null;if(T&&T.children&&T.children.length)if(l[T._id]&&l[T._id].collapsed)S=T._id;else{let v=r[m+1];v?g=v.num:g=T.children[T.children.length-1].num+1}if(!T){let v=t.find(M=>M.num===e);v&&(S=v.parentPage)}return{newPageNum:g,newPageParentId:S}},mn=(e,t=void 0)=>e.map(r=>r.children?{id:r._id,parentId:t,items:mn(r.children,r._id)}:{id:r._id,parentId:t}),Pn=e=>e.reduce((t,r)=>(t.push(r),r.items?t.concat(Pn(r.items)):t),[])});var U,At=_(()=>{"use strict";U=class{constructor({message:t,tag:r,type:l}){me(this,"message");me(this,"type");me(this,"tag");this.message=t,this.tag=r,this.type=l||"error"}}});var Mt,It,xr,Bt=_(()=>{"use strict";ee();Mt=e=>W.get(`/api/user/${e}/links`),It=e=>W.get(`/api/user/${e}/projects-domains`),xr=(e,t)=>W.post("/api/checkdomain",{type:e,domain:t})});var Wr,Cr,_t,vr,Nt=_(()=>{"use strict";ee();Wr=()=>W.get("/api/user_templates/"),Cr=async()=>{let{data:e}=await W.get("/api/help-tour-template/");return e||{}},_t=e=>W.delete("/api/template/",{id:e}),vr=(e,t)=>W.put("/api/template/",{id:e,name:t})});var Et,Rt,Ut,Ar,Lt=_(()=>{"use strict";ee();Et=(e,t)=>W.post("/api/checkdomain",{num_id:e,domain:t}),Rt=(e,t)=>W.post(`/api/mag/domain/${e}`,{domain:t,status:"on"}),Ut=e=>W.post(`/api/mag/domain/${e}`,{status:"off"}),Ar=e=>W.post("/api/domain/visit",{domain:e})});var Br,_r,Nr,Er,Dt,Ht,Gt=_(()=>{"use strict";ee();Br=async({email:e,projectNumIds:t,folderIds:r,sharesAll:l,role:m,folderRoles:T,projectRoles:g})=>{let S=await W.post("/api/team",{email:e,mags:t,folders:r,sharesAll:l,role:m,folderRoles:T,projectRoles:g});if(!S.teamMember)throw S.error||S;return S.teamMember},_r=async({email:e,projectNumIds:t,folderIds:r,sharesAll:l,role:m,folderRoles:T,projectRoles:g})=>{let S=await W.put("/api/team",{email:e,mags:t,folders:r,sharesAll:l,role:m,folderRoles:T,projectRoles:g});if(!S.teamMember)throw S.error||S;return S.teamMember},Nr=e=>W.delete("/api/team",{email:e}),Er=e=>W.post("/api/team/invite",{email:e}),Dt=()=>W.get("/api/team"),Ht=(e,t={isPending:!1})=>{let r=new URLSearchParams(t);return W.get(`/api/project/${e}/team${r.toString()?"?"+r:""}`)}});function li({project:e,router:t,inPreview:r,children:l}){let m=(0,s.useCallback)(o=>{let n={...o.attributes};return delete n.children,n},[]),[T,g]=(0,s.useState)(()=>{let o=e.pages.models.map(i=>m(i));o.sort((i,a)=>i.num-a.num);let n=We(o,null);return{project:e.attributes,owner:e.user.attributes,isOwner:!!t.isOwner,inPreview:!!r,pages:o,trashPages:[],pageRecentlyDeleted:!1,userTemplates:[],currentPageNum:t.getCurrentPageNum(),currentPageId:t.getCurrentPageId(),pagesTree:n,pagesParams:ye(n,{}),codeInjectUpgradeAlertShown:!1,publishInProgress:!1,unpublishInProgress:!1,isPublishError:!1,selectedPages:[],lockedPages:{},collaborators:[],team:[],allProjects:[],teamworkProjects:[],ownedProjectTeam:[],projectTeam:[],me:t.me.attributes}}),{pages:S,pagesTree:v,pagesParams:M,project:{user:N,opts:w,num_id:f,domain:I},currentPageId:E,currentPageNum:L,publishInProgress:A,unpublishInProgress:R,isOwner:J,me:Y}=T,X=(0,s.useCallback)(o=>{let n=t.pageOrder.get("order"),i=null;if(o>n.length)i=n[n.length-1].id;else{let a=n.find(c=>c.num===o);a&&(i=a.id)}i?t.showWorkspace({id:i}):t.showWorkspace({num:1})},[t]),Ye=(0,s.useCallback)((o,n)=>{let i=n.findIndex(a=>a._id===o.get("_id"));if(i>=0){let a=[...n];return a[i]&&(a[i]=m(o)),a}return n},[m]),te=(0,s.useRef)(void 0),Z=(0,s.useCallback)((o,n={})=>{te.current&&(te.current.hide(),te.current.remove()),te.current=new nt({$parent:document.querySelector("body > .popups"),router:t,opts:{type:"type-more-pages",is_contributor:!t.isOwner,owner_email:N?N.email:"",...n},alert_source:o}),te.current.render()},[N,t]),Xe=(0,s.useCallback)(()=>{g(o=>({...o,pageRecentlyDeleted:!1}))},[]),ke=(0,s.useRef)(void 0),Ze=(0,s.useCallback)(()=>{g(o=>({...o,pageRecentlyDeleted:!0})),ke.current&&clearTimeout(ke.current),ke.current=setTimeout(()=>{Xe()},4500)},[Xe]),oe=(0,s.useCallback)((o,n)=>e.set(o,n),[e]),de=(0,s.useCallback)((o,n)=>e.unset(o,n),[e]),to=(0,s.useCallback)((o,n)=>e.save(o,n),[e]),oo=(0,s.useCallback)((o,n,i)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.set(n,i)},[e]),no=(0,s.useCallback)((o,n,i)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.unset(n,i)},[e]),Oe=(0,s.useCallback)((o,n,i)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.save(n,i)},[e]),ro=(0,s.useCallback)(o=>{g(n=>({...n,currentPageNum:o}))},[]),et=(0,s.useCallback)(o=>{g(n=>({...n,inPreview:o}))},[]),io=(0,s.useCallback)((o,n)=>{g(i=>({...i,pagesParams:{...i.pagesParams,[o]:{...i.pagesParams[o],collapsed:n}}}))},[]),ne=(0,s.useCallback)(async o=>{await e.pages.find(i=>i.attributes._id===o).updateScreenshots(e.get("num_id"))},[e]),so=(0,s.useCallback)((o,n,i)=>new Promise((a,c)=>{let{newPageNum:b,newPageParentId:x}=we(o,S,v,M),k=t.workspace.page.get("order")?.default,F={num:b};n&&(F={...F,...n}),e.addPage(F,pe=>{if(pe&&pe.err)c(pe);else{let D=pe;n?window.RM.constructorRouter.trigger("notice:triggerMetrics","templateUsed"):D.isEmptyPage=!0,D.get("num")===2&&setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerEduTip","eduTipUseNavigation",{standAlone:!0})},0),D.set("parentPage",x),t.pageOrder.reorderPagesAfterAdd({page:D,magId:e.get("_id")}),e.onAdd(D),n&&(D.from_template=!0,D.hasGlobalWidgets()&&(e.addGlobalWidgetsFromTemplate(D),e.pages.map(re=>re.attributes._id).filter(re=>re!==D.id).forEach(re=>ne(re)))),i||t.showWorkspace({id:D.id}),a(D)}},!0,k)}),[t,e,S,v,M,ne]),ao=(0,s.useCallback)(o=>new Promise((n,i)=>{let a=e.getPage(o);if(!a)return i(new Error("Could not find page"));a.get("mid")||a.save({mid:e.get("_id")},{silent:!0});let{newPageNum:c,newPageParentId:b}=we(a.get("num"),S,v,M);a.duplicate(x=>{if(x instanceof Error)return x.message==="Server error: permission_denied"&&(le()?t.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):Z("duplicate page",{type:"type-more-pages"})),i(x);let h=x;h.set("parentPage",b),t.pageOrder.reorderPagesAfterAdd({page:h,magId:e.get("_id")}),e.onAdd(h),t.gg.guides?.model&&(t.gg.guides.model.addPage(h.id,{silent:t.gg.guides.hidden}),t.gg.guides.model.save()),t.showWorkspace({id:h.id}),n(x)},{num:c})}),[t,e,S,v,M,Z]),lo=(0,s.useCallback)(async()=>{let o=t._pageChanged;o&&typeof o=="string"&&(t._pageChanged=!1,await ne(o))},[t,ne]),go=(0,s.useCallback)(o=>new Promise((n,i)=>{t.pageOrder.saveInProgress()||(t.pageOrder.save({order:o,mid:t.mag.id},{success:()=>{e.trigger("change:pids",e,e.get("pids")),n()},error:i}),e.trigger("change:pids",e,e.get("pids")))}),[t,e]),co=(0,s.useCallback)(o=>new Promise((n,i)=>{if(t.isPageLocked(o))return i(new Error("This page is locked"));if(e.get("pids").length===1)return i(new Error("Can't delete last page"));let a=M[o],c=[];if(a&&a.children.length){let h=a.children;a.collapsed?t.pageOrder.removeParentIds(h):c=[...h]}if(c.push(o),!e.checkDeletingPages(c))return i(new Error("Can't delete all pages"));let b=c.includes(E),x=L;t.pageOrder.deletePagesFromOrder(c,e.get("_id")).then(()=>{e.deletePages(c,h=>{h instanceof Error?(t.pageOrder.load(e),i(h)):h&&h.deleteNotEmptyPages&&Ze(),b?X(x):t.triggerPageChange(),c.forEach(k=>t.removeWorkspace(k)),n({deleted:c})})},(h,k)=>{i(new Error(k))})}),[t,e,M,E,L,Ze,X]),po=(0,s.useCallback)(o=>new Promise((n,i)=>{e.restorePage(o,{success:a=>{let c=t.workspace.getPageNum();if(!c)throw"Unable to get current page number";let{newPageNum:b,newPageParentId:x}=we(c,S,v,M);a.set("num",b),a.set("parentPage",x),t.pageOrder.reorderPagesAfterAdd({page:a,magId:e.get("_id")}),e.onAdd(a),e.save(),t.showWorkspace({id:a.id}),n(a)},error:a=>{let c=JSON.parse(a.responseText);c.err==="permission_denied"&&Z("restore page",{type:"type-more-pages"}),i(c)}},!0)}),[t,e,S,v,M,Z]),uo=(0,s.useCallback)(o=>e.deleteTrashPages(o),[e]),mo=(0,s.useCallback)(()=>new Promise(o=>{e.get("has_deleted_pages")?e.fetchTrashPages().then(n=>{n&&g(i=>({...i,trashPages:n})),o(n)}):o([])}),[e]),Po=(0,s.useCallback)(()=>e.emptyTrash().then(()=>{g(o=>({...o,trashPages:[]}))}),[e]),To=(0,s.useCallback)(()=>e.loadUserTemplates().then(o=>(Array.isArray(o)&&g(n=>({...n,userTemplates:o})),o)),[e]),ho=(0,s.useCallback)(()=>e.hasGlobalWidgets(),[e]),fo=(0,s.useCallback)((o={})=>t.createTemplateFromCurrentPage(o).then(n=>(n&&g(i=>{let a=Array.from(i.userTemplates);return a.unshift(n),{...i,userTemplates:a}}),n)).catch(n=>{throw n&&n.message==="permission denied"&&Z("create user template",{type:"type-more-pages"}),n}),[t,Z]),So=(0,s.useCallback)(o=>_t(o).then(()=>{g(n=>({...n,userTemplates:n.userTemplates.filter(i=>i.id!==o)}))}),[]),bo=(0,s.useCallback)((o,n)=>{let i={hyphen:"The link should not start or end with a hyphen",onlyNumbers:"The link should not consist of digits only",uriLength:"The link should be less than 128 characters long",used:"You already have a page with this link",pageNotFound:"Can't find current page"},a=e.getPage(o);if(a){let c=a.validate({uri:n,parentPage:a.get("parentPage")});return c?i[Object.keys(c)[0]]:void 0}else return i.pageNotFound},[e]),Ae=(0,s.useCallback)(async()=>{let o=e.getUsedFonts({includeCustom:!0,excludeUnusedDefault:!0}),n=dt.sortFontsByProvider(o);return ut(e.id,n,!0)},[e]),xo=(0,s.useCallback)(async(o={})=>{let n=e.get("user").permissions||{},i=lt(ie.environment.preview,e.getAllWidgets()),a=Y?.plan?.level,c;a==="personal"||a==="freelancer"?c="Please upgrade account to publish another project. Check out the pricing to learn more.":c="Please upgrade your plan to publish more than one project.";let b=`Injected Code, Forms${Te("widget.lottie")?", Lottie":""} and Shots will not work in Published project.`;if(n.can_publish){if(i&&!n.can_use_e_commerce)throw new U({message:"Please upgrade your account to publish project with ecommerce.",tag:"type-publish-ecommerce"});if(e.hasCodeInjection()&&!t.me?.get("permissions")?.can_inject_code&&!o.skipWarnings)throw new U({message:b,tag:"type-code-injection",type:"warning"});if(e.hasWidgetsWithType("shots")&&!t.me?.get("permissions")?.can_use_shots&&!o.skipWarnings)throw new U({message:b,tag:"type-widget-shots",type:"warning"});if(e.hasWidgetsWithType("lottie")&&!t.me?.get("permissions")?.can_use_lottie&&!o.skipWarnings)throw new U({message:b,tag:"type-widget-lottie",type:"warning"});if(e.hasWidgetsWithType("form")&&!t.me?.get("permissions")?.can_use_forms&&!o.skipWarnings)throw new U({message:b,tag:"type-widget-shots",type:"warning"})}else{let x=n._reasons||{},h=x.can_publish&&x.can_publish.code;throw new U({message:le()?"You can't publish another project. Your subscription has been paused":h==="reason_publish_limit"?c:"Please verify your email address to publish this project.",tag:le()?"type-publish-paused-subcription":h==="reason_publish_limit"?"type-publish-limit":"type-publish-noemail"})}if(!A){g(x=>(G.sendAmplitudeEvent(H.Publish,{firstTime:!e.get("is_published"),zone:`editor ${x.inPreview?"preview":"project settings"}`}),{...x,publishInProgress:!0})),o.alsoExport&&N.permissions.can_export_template&&t.exportMagAsTemplateset(o.dontRenewScreenshots);try{await Ae();let x=await gt(e.get("num_id"));e.set({...e.parse(x),changed:!1}),g(h=>({...h,publishInProgress:!1}))}catch{g(h=>({...h,publishInProgress:!1,isPublishError:!0})),await new Promise(h=>setTimeout(h,5e3)),g(h=>({...h,isPublishError:!1}))}}},[t,e,Y,N,A,Ae]),wo=(0,s.useCallback)(async()=>{R||(g(o=>({...o,unpublishInProgress:!0})),await pt(e.get("num_id")),e.set({is_published:null,published:null,updated:null}),g(o=>({...o,unpublishInProgress:!1})))},[e,R]),yo=(0,s.useCallback)(async()=>{await ct(e.get("num_id")),window.location.reload()},[e]),K=(0,s.useCallback)(o=>t.me&&t.me.get("permissions")[o],[t]),le=(0,s.useCallback)(()=>t.me?.get("permissions")?._reasons?.limited_usage?.code==="reason_subscription_paused",[t]),Wo=(0,s.useCallback)(()=>{if(!K("can_export_pdf"))throw new U({message:p(fe,{children:["Please upgrade your account",d("br",{}),"to export the project to PDF.",d("br",{}),d("a",{href:`${ie.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"})]}),tag:"type-export-pdf"})},[K]),Co=(0,s.useCallback)(()=>{if(!K("can_export_code"))throw new U({message:p(fe,{children:["Please upgrade your account",d("br",{}),"in order to export the source",d("br",{}),"code of your projects.",d("br",{}),d("a",{href:`${ie.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-export-code"})},[K]),vo=(0,s.useCallback)(()=>{if(!K("can_use_iframe"))throw new U({message:p(fe,{children:["Please upgrade your account",d("br",{}),"in order to use iframe",d("br",{}),"for your projects.",d("br",{}),d("a",{href:`${ie.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-iframe-code"})},[K]),ko=(0,s.useCallback)(()=>{t.openCodeEditor()},[t]),Oo=(0,s.useCallback)(()=>["ci_head","ci_css","ci_body_top","ci_body_bottom"].some(o=>!!T.project[o]),[T.project]),Ao=(0,s.useCallback)(()=>e.hasCodeInjection(),[e]),Mo=(0,s.useCallback)(()=>e.hasWidgetsWithType("shots"),[e]),Io=(0,s.useCallback)(()=>e.hasWidgetsWithType("form"),[e]),Bo=(0,s.useCallback)(o=>{g(n=>{let i=n.lastSelectedPage&&n.selectedPages.includes(n.lastSelectedPage)?n.lastSelectedPage:t.getCurrentPageId();if(i){let a=n.pagesTree.reduce((k,F)=>(k.push(F),F.children?[...k,...F.children]:k),[]),c=a.findIndex(k=>k._id===o),b=a.findIndex(k=>k._id===i),x=a.slice(Math.min(c,b),Math.max(c,b)+1).map(k=>k._id).filter(k=>!n.selectedPages.includes(k)),h=[...n.selectedPages,...x];return{...n,selectedPages:h,lastSelectedPage:o}}return{...n,lastSelectedPage:o}})},[t]),_o=(0,s.useCallback)(o=>{g(n=>{let i=[...n.selectedPages];return i.includes(o)?i.splice(i.indexOf(o),1):i.push(o),{...n,selectedPages:i,lastSelectedPage:o}})},[]),No=(0,s.useCallback)(()=>{g(o=>({...o,selectedPages:[]}))},[]),Eo=(0,s.useCallback)(()=>{if(!J)return;let o=t.getCurrentPageId(),n=e.pages.find(i=>i.attributes._id===o);t.unlockPage(n)},[t,e,J]),Ro=(0,s.useCallback)(()=>{t.updateUrl(),t.triggerPageChange()},[t]),Uo=(0,s.useCallback)(o=>{t.getCurrentPageId()!==o.id&&t.showWorkspace(o)},[t]),Me=(0,s.useCallback)(async o=>{let[n,i]=await Promise.all([Dt(),Ht(o,{})]),{mags:a}=await W.get("/api/readymags/user");return{team:n,allProjects:a,teamworkProjects:a.filter(c=>c.num_id===o),ownedProjectTeam:n.filter(c=>c.projectNumIds.includes(o)),projectTeam:i}},[]),Lo=(0,s.useCallback)((o,n)=>{g(i=>({...i,team:o,ownedProjectTeam:o.filter(a=>a.projectNumIds.includes(n))}))},[]),Do=(0,s.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return Mt(n)},[t]),Ho=(0,s.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return It(n)},[t]),Go=(0,s.useCallback)(o=>mt({...o,numId:o.numId?o.numId:e.get("num_id")}).then(()=>{let{isPrivate:n,isPrivatePages:i,password:a}=o;e.set({is_private:n,isPrivatePages:i,pass:a!==void 0?a:e.get("pass")})}),[e]),jo=(0,s.useCallback)((o,n)=>{let i=Oe(o,{isPrivate:n},{patch:!0});i&&!(i instanceof Error)&&i.done(()=>{let a=(c,b,x)=>c.map(h=>(h._id===b&&(h.isPrivate=x),h));g(c=>{let b=a(c.pages,o,n),x=c.pagesTree.map(h=>(h._id===o&&(h.isPrivate=n),h.children&&h.children.length&&(h.children=a(h.children,o,n)),h));return{...c,pages:b,pagesTree:x,pagesParams:ye(x,c.pagesParams)}})})},[Oe]),Fo=(0,s.useCallback)(o=>{let n=N.permissions.viewer_opts_overrides||{},a={...e.get("opts"),...o==="phone_portrait"?e.get("viewport_phone_portrait")?.opts||{}:o==="tablet_portrait"?e.get("viewport_tablet_portrait")?.opts||{}:{},...n};return{...a,...e.get("is_private")&&{sharebutton:!1},...!a.menubutton&&{projectinfo:!1}}},[e,N]),ge=(0,s.useCallback)((o,n,i)=>{let a=Je.default.intersection(Object.keys(o),tt).length>0,c=i==="phone_portrait"||i==="tablet_portrait",b=a&&c?i:"default",x=Object.keys(o)[0],h={...o,...o.menubutton===!1&&{projectinfo:!1}};if(["arrows","menubutton","projectinfo","sharebutton","pagecounter","controlsontop","controlsontop","branding","slidein","scalableviewer"].includes(x)&&x==="scalableviewer"&&G.sendAmplitudeEvent(H.SettingsViewer,{settingsType:"scale layout"}),b==="phone_portrait"||b==="tablet_portrait"){let k=`viewport_${b}`,F={...e.get(k)?.opts||{},...h};return e.set(k,{...e.get(k)||{},opts:F},n),jt(e.get("num_id"),F,b)}else{let k={...e.get("opts"),...h};return e.set("opts",k,n),jt(e.get("num_id"),k,b)}},[e,w]),Vo=(0,s.useCallback)(o=>Et(f,o).then(n=>(oe({last_checked_domain:o},{silent:!0}),n)),[f,oe]),zo=(0,s.useCallback)(o=>Rt(f,o).then(()=>{oe({domain:o,domainStatus:"on"})}),[f,oe]),$o=(0,s.useCallback)(()=>Ut(f).then(o=>(de("domain"),de("domainStatus"),o)),[e,I,f,w,de,ge]),Ie=(0,s.useCallback)((o,n)=>{o&&g(i=>{let a=o.pages.models.map(b=>m(b)).filter(b=>n.includes(b._id));a.sort((b,x)=>b.num-x.num);let c=We(a,null);return{...i,project:o.attributes,pages:a,pagesTree:c,pagesParams:ye(c,i.pagesParams)}})},[m]),Be=(0,s.useCallback)(o=>{o&&g(n=>({...n,project:o.attributes}))},[]),_e=(0,s.useCallback)((o,n,i)=>{o&&(o.changed&&!i?.socketUpdate&&(o.changed.num||o.changed.parentPage)||g(a=>{let c=Ye(o,a.pages);c.sort((x,h)=>x.num-h.num);let b=We(c,null);return{...a,pages:c,pagesTree:b,pagesParams:ye(b,a.pagesParams)}}))},[Ye]),Ne=(0,s.useCallback)(o=>{o&&g(n=>{let i=Array.from(n.trashPages);return i.unshift(o.attributes),{...n,trashPages:i}})},[]),Ee=(0,s.useCallback)(o=>{o&&g(n=>{let i=Array.from(n.trashPages),a=i.findIndex(c=>c._id===o.get("_id"));return a>-1&&i.splice(a,1),{...n,trashPages:i}})},[]);(0,s.useEffect)(()=>{function o(){Me(e.attributes.num_id).then(n=>{g(i=>({...i,...n}))})}return o(),e.on(Ft(),Be),e.on("change:pids",Ie),e.pages.on(Vt(),_e),e.trashPages.on("add",Ne),e.trashPages.on("remove",Ee),O.on("refreshTeamworkData",o),()=>{e.off(Ft(),Be),e.off("change:pids",Ie),e.pages.off(Vt(),_e),e.trashPages.off("add",Ne),e.trashPages.off("remove",Ee),O.off("refreshTeamworkData",o)}},[e,Be,Ie,Ne,Ee,_e,Me]);let Re=(0,s.useCallback)(o=>et(o),[]);(0,s.useEffect)(()=>(t.on("togglePreview",Re),()=>{t.off("togglePreview",Re)}),[t,Re]);let Ue=(0,s.useCallback)(o=>{let n=o.getPageNum(),i=o.getPageId();n&&i&&g(a=>({...a,currentPageNum:n,currentPageId:i}))},[]);(0,s.useEffect)(()=>(t.on("pageChange",Ue),()=>{t.off("pageChange",Ue)}),[t,Ue]);let ce=(0,s.useCallback)(o=>{g(n=>({...n,currentPageNum:o.num,currentPageId:o._id}))},[]);(0,s.useEffect)(()=>(T.inPreview?t.on("previewPageChange",ce):t.off("previewPageChange",ce),()=>{t.off("previewPageChange",ce)}),[T.inPreview,t,ce]);let Le=(0,s.useCallback)((o,n)=>{g(i=>({...i,lockedPages:{...i.lockedPages,[o]:n}}))},[]),De=(0,s.useCallback)(o=>{g(n=>{let{[o]:i,...a}=n.lockedPages;return{...n,lockedPages:a}})},[]),He=(0,s.useCallback)(({list:o})=>{g(n=>({...n,collaborators:o||[]}))},[]);(0,s.useEffect)(()=>(O.on("page:locked",Le),O.on("page:unlocked",De),O.on("sockets:connect",He),()=>{O.off("page:locked",Le),O.off("page:unlocked",De),O.off("sockets:connect",He)}),[Le,De,He]),(0,s.useEffect)(()=>{w.branding===void 0&&ge({branding:w.endpage})},[w,ge]);let qo=(0,s.useCallback)(o=>{let n=T.project.user.permissions.viewer_opts_overrides||{};return{disabled:[...Object.keys(n),...o?.menubutton?[]:["projectinfo"],...T.project.is_private?["sharebutton"]:[],...T.project.user.permissions.must_show_branding?["branding"]:[]],permissionOverrides:n}},[T.project]),Jo=(0,s.useCallback)(async(o,n)=>{await Tt(o,n),g(i=>({...i,project:{...i.project,allow_iframe_embed:o==="allow"}}))},[]),Ko={projectSet:oe,projectUnset:de,projectSave:to,pageSet:oo,pageUnset:no,pageSave:Oe,setCurrentPageNum:ro,setInPreview:et,setPageCollapse:io,addNewPage:so,duplicatePage:ao,renewLastScreenshot:lo,updatePageScreenshot:ne,restorePage:po,saveOrder:go,deletePage:co,deletePagesFromTrash:uo,updateTrash:mo,emptyTrash:Po,getUserTemplates:To,hasGlobalWidgets:ho,createTemplateFromCurrentPage:fo,deleteUserTemplate:So,validatePageUri:bo,updateUsedFonts:Ae,publishWithNotice:xo,unpublish:wo,restoreToPublished:yo,checkPDFExportPermission:Wo,checkHTMLExportPermission:Co,checkIFrameExportPermission:vo,openCodeEditor:ko,hasProjectCode:Oo,hasCustomCode:Ao,hasShots:Mo,hasForms:Io,hasPermission:K,isSubscriptionPaused:le,selectPage:_o,selectPagesRange:Bo,deselectPages:No,takeOverCurrentPage:Eo,updateUrl:Ro,changeWorkspace:Uo,loadTeamworkData:Me,updateTeam:Lo,getProjectOptions:Fo,setProjectOptions:ge,loadUserProjectsLinks:Do,getDomainsAmount:Ho,setPrivacy:Go,setPageIsPrivate:jo,checkDomain:Vo,mapDomain:zo,unmapDomain:$o,getProjectPermissionsOverrides:qo,toggleAllowIframeEmbed:Jo};return d(zt.Provider,{value:{...T,...Ko,projectMag:e},children:l})}var s,Je,zt,jt,We,ye,Ft,Vt,gi,$t=_(()=>{"use strict";s=ue(Ge());je();Je=ue(Qo());Ot();ee();en();nn();rn();Xo();Pe();Yo();At();Zo();sn();Bt();Nt();Lt();Gt();st();qe();ot();V();zt=(0,s.createContext)({}),jt=Je.default.throttle(Pt,300),We=(e,t)=>{let r=[];for(let l in e)if(e[l].parentPage===t){let m=We(e,e[l]._id),T=Object.assign({},e[l]);m.length&&(T.children=m),r.push(T)}else if(e[l].parentPage===void 0){let m=Object.assign({},e[l]);r.push(m)}return r},ye=(e,t)=>{let r={};return e.forEach((l,m)=>{if(r[l._id]={collapsed:t[l._id]?t[l._id].collapsed:!0,viewNum:m+1,uri:l.uri?l.uri:(m+1).toString(),children:[]},l.children){let T=[];l.children.forEach((g,S)=>{T.push(g._id),r[g._id]={collapsed:t[g._id]?t[g._id].collapsed:!0,viewNum:S+1,uri:g.uri?g.uri:(S+1).toString(),children:[],parentId:l._id}}),r[l._id].children=T}}),r},Ft=()=>["title","description","user","folder","uri","domain","domainStatus","last_checked_domain","has_deleted_pages","master_share_pid","changed","is_published","is_private","isPrivatePages","pass","pass_bg","published","opts","viewport_phone_portrait","viewport_tablet_portrait"].map(t=>`change:${t}`).join(" "),Vt=()=>["num","parentPage","screenshot","viewport_phone_portrait","viewport_tablet_portrait","title","uri","seo","hidden","custom_shares"].map(t=>`change:${t}`).join(" ");gi=()=>(0,s.useContext)(zt)});var Ke=_(()=>{"use strict"});function Wi({magModel:e,router:t,children:r}){let[l,m]=(0,B.useReducer)(Sn,{router:t,magModel:e},hn),T=(0,B.useCallback)(({pageNumber:f,scrollTop:I}={})=>{let E=t.workspace?.page.get("num");window.RM.constructorRouter.togglePreview({pageNumber:f??E,scrollTop:I}),l.inPreview||window.RM.constructorRouter.trigger("notice:triggerEduTipClose")},[t]);(0,B.useEffect)(()=>{let f=()=>{m({type:"togglePreview"})};return window.RM.constructorRouter.unbindGlobalKeyPress("p",T),window.RM.constructorRouter.bindGlobalKeyPress({key:"p",handler:T}),l.inPreview?(window.RM.constructorRouter.off("previewOpen",f),window.RM.constructorRouter.on("previewClose",f)):(window.RM.constructorRouter.off("previewClose",f),window.RM.constructorRouter.on("previewOpen",f)),()=>{window.RM.constructorRouter.unbindGlobalKeyPress("p",T),window.RM.constructorRouter.off("previewOpen",f),window.RM.constructorRouter.off("previewClose",f)}},[l.inPreview]),(0,B.useEffect)(()=>{localStorage.setItem(qt,JSON.stringify({gridSize:l.gridSize}))},[l.gridSize]);let g=(0,B.useCallback)(()=>{m({type:"openMagMenu"})},[]),S=(0,B.useCallback)(()=>{m({type:"closeMagMenu"})},[]),v=(0,B.useCallback)((f,I)=>{I.viewertype!==l.magMenuOrientation&&m({type:"setMagMenuOrientation",orientation:I.viewertype}),I.menubutton!==l.magMenuOn&&m({type:"setMagMenu",isOn:I.menubutton}),I.controlsontop!==l.controlsOnTop&&m({type:"setControlsOnTop",onTop:I.controlsontop})},[l.magMenuOrientation,l.magMenuOn,l.controlsOnTop]);(0,B.useEffect)(()=>(O.on("magMenu:open",g),O.on("magMenu:close",S),()=>{O.off("magMenu:open",g),O.off("magMenu:close",S)}),[g,S]),(0,B.useEffect)(()=>(O.listenTo(e,"change:opts",v),()=>{O.stopListening(e,"change:opts",v)}),[v]);let M=(0,B.useCallback)(()=>{m({type:"setReadyToPublish",ready:!0})},[]);(0,B.useEffect)(()=>(O.listenTo(t,"previewMag:load:success",M),()=>{O.stopListening(t,"previewMag:load:success",M)}),[M]);let N=()=>{m({type:"toggleCartSidebarState"})};(0,B.useEffect)(()=>(O.on("ecommerce:cartsidebar:visibility:changed",N),()=>{O.off("ecommerce:cartsidebar:visibility:changed",N)}),[N]);let w=(f,I)=>new Promise((E,L)=>{let A=e.getPage(f);A||E(null),A.save({hidden:I}).done(R=>{E(R)}).fail(R=>{L(R.responseJSON)})});return d(Ce.Provider,{value:{...l,dispatch:m,setPageVisibility:w,togglePreview:T},children:r})}var B,Ce,qt,Jt,hn,fn,Sn,Ci,Kt=_(()=>{"use strict";B=ue(Ge());Ke();Pe();V();Ce=(0,B.createContext)({}),qt="rm_pageSettings",Jt={};try{let e=localStorage.getItem(qt);Jt=JSON.parse(e||"{}")}catch{}hn=({router:e,magModel:t})=>({inPreview:!!e.previewMode,isMagMenuOpen:!1,isTrashOpened:!1,isPageSettingsOpened:!1,isPrivatePagesOpened:!1,isHelpPopupOpened:!1,isUserTemplatesModalShown:!1,isRmTemplatesModalShown:!1,isPageActionsPopupOpenedFor:!1,gridSize:Jt.gridSize||0,selectedPages:{},isDragging:!1,magMenuOrientation:t.attributes.opts.viewertype,magMenuOn:t.attributes.opts.menubutton,controlsOnTop:t.attributes.opts.controlsontop,readyToPublish:!0,addingPage:!1,isTeamworkModalOpened:!1,exportAsTemlate:!1,dontRenewScreenshots:!1,showTourOnOpen:!!e.showTourOnOpen,helpTourIsFinished:!!e.helpTourIsFinished,isCartSidebarOpened:!1,showTips:!!e.me?.attributes.constructor_show_tips,masterSharePidIsChanging:!1}),fn=(e,t)=>{let r={...e.selectedPages};return r[t]?delete r[t]:r[t]=!0,r},Sn=(e,t)=>{switch(t.type){case"togglePreview":{let r=!e.inPreview;return{...e,inPreview:r,readyToPublish:r?!1:e.readyToPublish,notice:void 0}}case"openMagMenu":return{...e,isMagMenuOpen:!0};case"closeMagMenu":return{...e,isMagMenuOpen:!1};case"setMagMenuOrientation":return{...e,magMenuOrientation:t.orientation};case"setMagMenu":return{...e,magMenuOn:t.isOn};case"setControlsOnTop":return{...e,controlsOnTop:t.onTop};case"toggleTrash":return{...e,isTrashOpened:!e.isTrashOpened};case"togglePageSettings":return{...e,isPageSettingsOpened:!e.isPageSettingsOpened,isHelpPanelOpen:!1};case"togglePrivatePages":return{...e,isPrivatePagesOpened:t.payload?!0:!e.isPrivatePagesOpened,privatePageSelected:t.payload};case"toggleHelpPopup":return{...e,isHelpPopupOpened:!e.isHelpPopupOpened};case"toggleHelpTourIsFinished":return{...e,helpTourIsFinished:t.finished};case"toggleUserTemplatesModal":return{...e,isUserTemplatesModalShown:!e.isUserTemplatesModalShown};case"toggleRmTemplatesModal":return{...e,isRmTemplatesModalShown:!e.isRmTemplatesModalShown};case"setPageActionsPopup":return{...e,isPageActionsPopupOpenedFor:t.payload};case"toggleGridSize":return{...e,gridSize:e.gridSize===0?1:0};case"togglePageSelection":return{...e,selectedPages:fn(e,t.payload)};case"setDragging":return{...e,isDragging:t.payload};case"setReadyToPublish":return{...e,readyToPublish:t.ready};case"setAddingPage":return{...e,addingPage:t.inProgress};case"toggleTeamworkModal":return{...e,isTeamworkModalOpened:t.payload};case"toggleExportAsTemlate":return{...e,exportAsTemlate:!e.exportAsTemlate};case"toggleDontRenewScreenshots":return{...e,dontRenewScreenshots:!e.dontRenewScreenshots};case"toggleShowTourOnOpen":return{...e,showTourOnOpen:t.showOnOpen};case"toggleCartSidebarState":return{...e,isCartSidebarOpened:!e.isCartSidebarOpened};case"toggleShowTips":return{...e,showTips:!e.showTips};case"toggleMasterSharePidChanging":return{...e,masterSharePidIsChanging:!e.masterSharePidIsChanging};default:return e}};Ci=()=>(0,B.useContext)(Ce)});var Qt=_(()=>{"use strict";$t();Kt();Ke()});function Hi(){let e=On(),t=(0,ae.useContext)(Ce);(0,ae.useEffect)(()=>{typeof window<"u"&&window.RM&&q({...e,router:window.RM.constructorRouter,isSmartTip:Yt})},[]);let[{router:r,isSmartTip:l}]=kn(),m=(w,f={})=>{xe()||(f.closeByTimer&&(delete f.closeByTimer,setTimeout(()=>{q(e.visible?{...e,visible:!1}:e)},Xt)),q({...e,...f,message:w,needShowHelpIcon:!1,visible:!0,isTipType:!1}))},T=w=>{q({...e,message:w})},g=(w,f={})=>{if(xe()||!r||!r.me||!t.showTips||l&&!eo(w)||!l&&eo(w))return;let E=(r.me.get("edu_tips_state")||{})[w]||0,L=()=>{e.visible&&(ve(w,2,r),q({...e,visible:!1}))};if(f.closeByTimer)delete f.closeByTimer,setTimeout(L,Xt);else if(l){setTimeout(L,bn);let A=wn(w);A&&ve(A,3,r)}switch(E){case 3:break;case 2:if(f.showOnce)break;q({...e,visible:!0,message:w,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:f.standAlone});break;case 0:{if(ve(w,2,r),xn.includes(w)&&O.trigger("tips:show",w),l){let A=Cn(w);A&&G.sendAmplitudeEvent(H.EditorTips2,{tip:A})}else{let A=Wn(w);A&&G.sendAmplitudeEvent(H.EditorTips,{tip:A})}q({...e,visible:!0,message:w,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:f.standAlone})}}},S=()=>{e.visible&&e.message&&(ve(e.message,3,r),q({...e,visible:!1}))},v=()=>{e.visible&&q({...e,visible:!1})},M=(w,f)=>{if(!r||!r.me||!r.me.get("constructor_show_tips")||xe()||!t.showTips)return;let I=yn(w,f,r),E=r.me.get("edu_tips_state")||{},L=(A,R)=>{if(!A||!R)return!1;for(let J in R)if(R.hasOwnProperty(J)){let Y=A?.[J],X=R[J];if(typeof X=="number"&&typeof Y=="number"&&X>Y||X!==Y)return!1}return!0};for(let A in Qe)if(Qe.hasOwnProperty(A)&&!E[A]){let R=Qe[A];(typeof R=="function"?R(I):L(I,R))&&g(A,{showOnce:!0})}},N=({id:w,color:f})=>{if(!l||!r||!r.me||!Yt)return;let I=r.me.get("behavior_metrics")||{},E=I.triggeredColors||{};if(w in E)E[w]=f;else{for(let L of Object.values(E))L===f&&g("eduTipUseColorPalette");E[w]=f,I.triggeredColors=E,r.me.save({behavior_metrics:I},{patch:!0})}};return(0,ae.useEffect)(()=>{if(r)return r.on("notice:show",m),r.on("notice:hide",v),r.on("notice:triggerEduTip",g),r.on("notice:triggerEduTipClose",S),r.on("notice:triggerMetrics",M),r.on("notice:triggerColorMetrics",N),()=>{r.off("notice:show",m),r.off("notice:hide",v),r.off("notice:triggerEduTip",g),r.off("notice:triggerEduTipClose",S),r.off("notice:triggerMetrics",M),r.off("notice:triggerColorMetrics",N)}},[r,e]),{showNotice:m,setNoticeMessage:T,triggerEduTip:g,triggerEduTipClose:S,hideNotice:v,triggerMetrics:M,triggerColorMetrics:N}}var ae,Yt,Qe,Xt,bn,xn,Zt,wn,ve,yn,Wn,Cn,eo,vn,kn,q,On,qe=_(()=>{"use strict";ae=ue(Ge());je();rt();Pe();st();kt();Qt();ot();Yt=Te("constructor.smartTips"),Qe={eduTipUseViewportsIcon:{viewportIconHovered:!0},eduTipOnDeleteMobileWidget:{widgetDeletedOnMobile:!0},eduTipUseBundleDragTriangle:{bundleDragHovered:!0},eduTipUseShortcutToChangeSizes:{widgetSlightlyResized:!0},eduTipUseShortcutToMoveText:{countTextWidgetCreated:9},eduTipUseShortcutToCopyAnimation:{countAnimatedWidgetCreated:2},eduTipUseShortcutToEnableGuides:{countWidgetCreated:3,guidesTurnOn:void 0},eduTipUseShortcutToEnableSizes:{widgetResized:!0,sizesToolTurnOn:void 0},eduTipUseFix:{countWidgetCreated:10,fixedWidgetUsed:void 0},eduTipUseAbovePages:{countFixedWidgetCreated:3,onAllPagesWidgetUsed:void 0},eduTipUsePlusIcon:{helpTourSkipped:!0},eduTipUseWidgetSettings:{helpTourSkipped:!0,countWidgetCreated:1},eduTipUseBlocks:{secondWidgetMoved:!0},eduTipUseTextStylesWidget:{templateUsed:void 0,countTextWidgetCreated:3},eduTipUseTextStylesControl:{templateUsed:void 0,textWidgetCopied:!0},eduTipUseColorPalette:{sameColorUsed:!0,templateUsed:void 0},eduTipUseArrangeControl:{mobileGroupSelected:!0},eduTipUseGroupEditing:{multipleWidgetsOfSameTypeSelected:!0}},Xt=6e3,bn=15e3,xn=["eduTipUseWidgetSettings","eduTipUseTextStylesControl","eduTipUseColorPalette","eduTipUseArrangeControl"],Zt=[["eduTipUseTextStylesWidget","eduTipUseTextStylesControl"]],wn=e=>{for(let t=0;t<Zt.length;t++){let r=Zt[t];if(r.includes(e))return r.find(l=>l!==e)}return!1},ve=(e,t,r)=>{let l=r?.me;if(!l)return;let m=l.get("edu_tips_state")||{};m[e]=t,l.save({edu_tips_state:m},{patch:!0})},yn=(e,t,r)=>{let l=r?.me;if(!l)return{};let m=l.get("behavior_metrics")||{},T=e.includes("count"),g=m[e];return T&&t===void 0?m[e]=typeof g=="number"?g+1:1:m[e]=t===void 0?!0:t,l.save({behavior_metrics:m},{patch:!0}),m},Wn=e=>{switch(e){case"eduTipUseCommentsMode":return"comments for collaborators";case"eduTipUseShortcutToEnableGuides":return"guides shortcut";default:return!1}},Cn=e=>{switch(e){case"eduTipUsePlusIcon":return"plus icon";case"eduTipUseWidgetSettings":return"widget settings";case"eduTipUseBlocks":return"distance between blocks";case"eduTipUseNavigation":return"horizontal vertical navigation";case"eduTipUseColorPalette":return"palette";case"eduTipUseTextStylesWidget":return"text styles";case"eduTipUseTextStylesControl":return"text styles";case"eduTipUseOnboarding":return"beginners onboarding kit";case"eduTipUseArrangeControl":return"arrange";default:return!1}},eo=e=>!!Object.values(it).includes(e),vn={message:"",visible:!1,canBeClosed:!0,needShowHelpIcon:!1,isTipType:!1,router:null},[kn,q,On]=he(vn)});export{xt as a,mn as b,Pn as c,Ot as d,U as e,At as f,xr as g,Bt as h,Wr as i,Cr as j,vr as k,Nt as l,Ar as m,Lt as n,Br as o,_r as p,Nr as q,Er as r,Gt as s,zt as t,li as u,gi as v,Ce as w,Wi as x,Ci as y,Qt as z,xn as A,kn as B,On as C,Hi as D,qe as E,be as F,$ as G,lr as H,vt as I,gr as J,cr as K,pn as L,pr as M,ur as N,mr as O,Pr as P,xe as Q,kt as R};
